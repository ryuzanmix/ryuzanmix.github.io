<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>詳細依頼フォーム - Ryuzan Mix Salon</title>
  <meta content="プロ仕様の詳細設定で理想のMIXを実現！録音音源情報、ピッチ補正、ハモリ方向性など、具体的な楽曲例付きで簡単設定。" name="description"/>
  <meta content="歌ってみた,MIX,依頼,フォーム,VTuber,ボカロ,詳細,自動生成,DM,プロ仕様" name="keywords">
  
  <!-- ファビコン -->
  <link href="favicon256.png" rel="icon" sizes="32x32" type="image/png"/>
  <link href="favicon256.png" rel="icon" sizes="192x192" type="image/png"/>
  <link href="favicon256.png" rel="apple-touch-icon"/>
  
  <!-- SEO -->
  <link href="https://ryuzanmix.github.io/request-form.html" rel="canonical"/>
  <meta content="index,follow" name="robots"/>
  
  <!-- 外部リソース -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet"/>
  
  <!-- OGP -->
  <meta content="website" property="og:type"/>
  <meta content="https://ryuzanmix.github.io/request-form.html" property="og:url"/>
  <meta content="詳細依頼フォーム - Ryuzan Mix Salon" property="og:title"/>
  <meta content="詳細な設定で依頼文章を自動生成！プロ仕様の歌ってみたMIX依頼フォーム。" property="og:description"/>
  <meta content="https://ryuzanmix.github.io/og-image.png" property="og:image"/>

  <!-- スタイルシート -->
  <link href="styles.css" rel="stylesheet"/>

  <style>
    /* フォーム専用スタイル */
    .form-main {
      margin-top: 80px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 30px;
      background: var(--card);
      border-radius: 20px;
      box-shadow: var(--shadow);
      position: relative;
    }

    .back-link {
      position: absolute;
      top: 20px;
      left: 20px;
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: color 0.3s ease;
      min-height: var(--touch-target-min);
    }

    .back-link:hover, .back-link:focus {
      color: var(--primary-dark);
    }

    .header h1 {
      color: var(--primary-dark);
      font-size: clamp(1.8rem, 4vw, 2rem);
      margin-bottom: 10px;
    }

    .header p {
      color: var(--text-light);
      font-size: var(--font-size-large);
    }

    .form-card {
      background: var(--card);
      padding: 30px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .form-section h3 {
      color: var(--primary-dark);
      font-size: var(--font-size-large);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text);
      font-size: var(--font-size-base);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .required {
      color: var(--accent);
      font-size: var(--font-size-small);
    }

    .optional {
      color: var(--text-muted);
      font-size: var(--font-size-small);
    }

    input[type="text"], input[type="url"], input[type="email"], input[type="number"], select, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: var(--font-size-base);
      transition: border-color 0.3s ease;
      background: white;
      min-height: var(--touch-target-min);
      line-height: var(--line-height-normal);
    }

    input[type="text"]:focus, input[type="url"]:focus, input[type="email"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(178, 143, 221, 0.2);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      line-height: var(--line-height-normal);
    }

    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px;
      background: var(--bg-secondary);
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
      min-height: var(--touch-target-min);
    }

    .checkbox-item:hover, .checkbox-item:focus-within {
      background: var(--primary-light);
    }

    .checkbox-item input[type="checkbox"] {
      width: auto;
      margin: 0;
      min-height: auto;
    }

    .radio-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .radio-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px;
      background: var(--bg-secondary);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      min-height: var(--touch-target-min);
    }

    .radio-item:hover, .radio-item:focus-within {
      background: var(--primary-light);
    }

    .radio-item input[type="radio"]:checked + .radio-label {
      color: var(--primary-dark);
      font-weight: 600;
    }

    .radio-item:has(input[type="radio"]:checked) {
      background: var(--primary-light);
      border-color: var(--primary);
    }

    .radio-item input[type="radio"] {
      width: auto;
      margin: 0;
      min-height: auto;
    }

    .help-text {
      font-size: var(--font-size-small);
      color: var(--text-muted);
      margin-top: 5px;
      line-height: var(--line-height-normal);
    }

    .generate-btn {
      width: 100%;
      background: var(--primary);
      color: white;
      border: none;
      padding: 16px 24px;
      border-radius: 50px;
      font-size: var(--font-size-large);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
      min-height: var(--touch-target-min);
    }

    .generate-btn:hover, .generate-btn:focus {
      background: var(--primary-dark);
      transform: translateY(-2px);
      outline: none;
      box-shadow: 0 0 0 3px rgba(178, 143, 221, 0.4);
    }

    .generate-btn:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
      transform: none;
    }

    .output-section {
      display: none;
      margin-top: 30px;
    }

    .output-section.show {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .output-card {
      background: var(--card);
      border: 2px solid var(--success);
      border-radius: 20px;
      overflow: hidden;
    }

    .output-header {
      background: var(--success);
      color: white;
      padding: 20px;
      text-align: center;
    }

    .output-content {
      padding: 30px;
    }

    .copy-area {
      background: #f8f8f8;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      font-family: monospace;
      font-size: var(--font-size-small);
      line-height: var(--line-height-loose);
      white-space: pre-wrap;
      margin: 20px 0;
      position: relative;
    }

    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: var(--font-size-small);
      cursor: pointer;
      transition: background 0.3s ease;
      min-height: 36px;
    }

    .copy-btn:hover, .copy-btn:focus {
      background: var(--primary-dark);
    }

    .copy-btn.copied {
      background: var(--success);
    }

    .contact-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .contact-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 30px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      border: 2px solid var(--primary);
      background: white;
      color: var(--primary);
      min-height: var(--touch-target-min);
      font-size: var(--font-size-small);
    }

    .contact-btn:hover, .contact-btn:focus {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
      outline: none;
    }

    .contact-btn.primary {
      background: var(--primary);
      color: white;
    }

    .contact-btn.primary:hover, .contact-btn.primary:focus {
      background: var(--primary-dark);
    }

    .section-indicator {
      background: var(--primary-light);
      color: var(--primary-dark);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: var(--font-size-small);
      font-weight: 600;
    }

    .validation-error {
      border-color: var(--error) !important;
      box-shadow: 0 0 0 2px rgba(244, 67, 54, 0.2) !important;
    }

    .checkbox-item.validation-error {
      border-color: var(--error) !important;
      background-color: #ffebee !important;
    }

    /* 準備中アイテムのスタイル（共通） */
    .preparing-item {
      opacity: 0.5 !important;
      background: #f8f8f8 !important;
      cursor: not-allowed !important;
      position: relative;
    }

    .preparing-item:hover {
      background: #f8f8f8 !important;
    }

    .preparing-item::after {
      content: "準備中";
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      background: var(--warning);
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 600;
      z-index: 10;
    }

    /* ラジオボタン用準備中スタイル */
    .radio-item.preparing-item {
      border-color: #ddd !important;
    }

    /* チェックボックス用準備中スタイル */
    .checkbox-item.preparing-item {
      border-color: #ddd !important;
    }

    .error-message {
      color: var(--error);
      font-size: var(--font-size-small);
      margin-top: 5px;
      display: none;
    }

    /* レスポンシブ対応 */
    @media (max-width: 768px) {
      .form-main {
        margin-top: 70px;
      }

      .container {
        padding: 15px;
      }
      
      .form-card {
        padding: 20px;
        border-radius: 16px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .checkbox-group, .radio-group {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .radio-item, .checkbox-item {
        padding: 16px;
        min-height: 56px;
        font-size: 16px;
      }

      .back-link {
        position: static;
        margin-bottom: 20px;
        justify-content: center;
        padding: 12px;
        border-radius: 8px;
        background: var(--bg-secondary);
      }

      .header h1 {
        font-size: var(--font-size-xl);
      }

      .contact-buttons {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .form-section h3 {
        font-size: 1.1rem;
        line-height: 1.4;
      }

      .section-indicator {
        display: block;
        margin-top: 5px;
      }

      /* モバイルでのタッチ対応強化 */
      input, select, textarea {
        font-size: 16px;
        min-height: 48px;
        padding: 14px 16px;
      }

      textarea {
        min-height: 100px;
      }

      .generate-btn {
        min-height: 56px;
        font-size: 18px;
        font-weight: 700;
      }

      .help-text {
        font-size: 14px;
        line-height: 1.5;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 10px;
      }

      .form-card {
        padding: 16px;
      }

      .header {
        padding: 20px;
      }

      .nav-inner {
        gap: 8px;
        padding: 0 10px;
      }

      .nav-inner a {
        font-size: 12px;
        padding: 6px 10px;
      }
    }
  </style>
</head>

<body>
  <!-- 統一ナビゲーション -->
  <nav class="guide-header-nav" style="position: fixed; top: 0; left: 0; right: 0; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); z-index: 1000; padding: 10px 0; border-bottom: 1px solid var(--border); box-shadow: var(--shadow);">
    <div class="nav-inner" style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: center; gap: 20px; padding: 0 20px; flex-wrap: wrap;">
      <a href="index.html" style="font-size: 14px; font-weight: 500; color: var(--text); padding: 8px 16px; border-radius: 20px; transition: all 0.3s ease; text-decoration: none;">ホーム</a>
      <a href="index.html#playlist" style="font-size: 14px; font-weight: 500; color: var(--text); padding: 8px 16px; border-radius: 20px; transition: all 0.3s ease; text-decoration: none;">実績</a>
      <a href="index.html#about" style="font-size: 14px; font-weight: 500; color: var(--text); padding: 8px 16px; border-radius: 20px; transition: all 0.3s ease; text-decoration: none;">サロンについて</a>
      <a href="index.html#pricing" style="font-size: 14px; font-weight: 500; color: var(--text); padding: 8px 16px; border-radius: 20px; transition: all 0.3s ease; text-decoration: none;">料金</a>
      <a href="recording-guide.html" style="font-size: 14px; font-weight: 500; color: var(--text); padding: 8px 16px; border-radius: 20px; transition: all 0.3s ease; text-decoration: none;">録音ガイド</a>
      <a href="request-form.html" class="current" style="font-size: 14px; font-weight: 500; background: var(--primary-light); color: var(--primary-dark); padding: 8px 16px; border-radius: 20px; transition: all 0.3s ease; text-decoration: none;">詳細依頼</a>
      <a href="index.html#faq" style="font-size: 14px; font-weight: 500; color: var(--text); padding: 8px 16px; border-radius: 20px; transition: all 0.3s ease; text-decoration: none;">よくある質問</a>
      <a href="index.html#contact" style="font-size: 14px; font-weight: 500; color: var(--text); padding: 8px 16px; border-radius: 20px; transition: all 0.3s ease; text-decoration: none;">お問い合わせ</a>
    </div>
  </nav>

  <div class="form-main">
    <div class="container">
      <div class="header">
        <a href="index.html" class="back-link">
          <i class="fas fa-arrow-left"></i>
          メインページに戻る
        </a>
        <h1>🎵 詳細依頼フォーム</h1>
        <p>プロ仕様の詳細設定で、理想通りのMIXを実現します</p>
      </div>

      <div style="background: #fff3cd; border: 2px solid var(--warning); border-radius: 20px; padding: 25px; margin-bottom: 30px; text-align: center;">
        <h3 style="color: var(--warning); margin-bottom: 15px;">
          <i class="fas fa-exclamation-triangle"></i>
          フォーム入力前の重要なお知らせ
        </h3>
        <p style="color: var(--warning); font-weight: 600; margin-bottom: 12px;">
          <strong>ご依頼の際は、<a href="recording-guide.html" style="color: var(--warning); text-decoration: underline;">📱 録音方法ガイド</a>を必ずご確認ください。</strong>
        </p>
        <p style="color: var(--warning); font-size: 0.9rem; margin: 0;">
          適切な録音方法により、MIXの仕上がりが大きく向上します。
        </p>
      </div>

      <form id="requestForm">
        <!-- 依頼者情報 -->
        <div class="form-card">
          <div class="form-section">
            <h3>👤 依頼者情報 <span class="section-indicator">必須</span></h3>
            
            <div class="form-row">
              <div class="form-group">
                <label for="clientName">依頼者名 <span class="required">※必須</span></label>
                <input type="text" id="clientName" placeholder="例：桜音みつき、@sakura_mix、みつきちゃん" required>
                <div class="error-message" id="clientNameError">お名前またはハンドルネームを入力してください</div>
              </div>
              <div class="form-group">
                <label for="clientContact">連絡先 <span class="required">※必須</span></label>
                <input type="text" id="clientContact" placeholder="例：sakura@example.com、@sakura_mix" required>
                <div class="error-message" id="clientContactError">メールアドレスまたはSNSアカウントを入力してください</div>
              </div>
            </div>

            <div class="form-group">
              <label for="contactMethod">希望連絡方法 <span class="required">※必須</span></label>
              <select id="contactMethod" required>
                <option value="">選択してください</option>
                <option value="twitter">X（Twitter）DM</option>
                <option value="email">メール</option>
                <option value="discord">Discord</option>
                <option value="line">LINE</option>
                <option value="other">その他</option>
              </select>
              <div class="error-message" id="contactMethodError">希望連絡方法を選択してください</div>
            </div>
          </div>
        </div>

        <!-- ポートフォリオ掲載可否 -->
        <div class="form-card">
          <div class="form-section">
            <h3>📂 ポートフォリオ掲載について <span class="section-indicator">必須</span></h3>
            
            <div class="form-group">
              <label>完成作品のポートフォリオ掲載 <span class="required">※必須</span></label>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="portfolioConsent" value="allowed" checked>
                  <span class="radio-label">掲載可<br><small>ポートフォリオとして掲載を許可</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="portfolioConsent" value="denied">
                  <span class="radio-label">掲載不可<br><small>Webサイト・X・YouTube等での掲載を禁止</small></span>
                </label>
              </div>
              <div class="help-text">
                完成したMIX作品を、当Webサイトや、X（Twitter）、YouTube等の動画サイトにポートフォリオとして掲載することの可否をお選びください。
              </div>
            </div>
          </div>
        </div>

        <!-- 楽曲情報 -->
        <div class="form-card">
          <div class="form-section">
            <h3>🎵 楽曲情報 <span class="section-indicator">必須</span></h3>
            
            <div class="form-row">
              <div class="form-group">
                <label for="songTitle">楽曲タイトル <span class="required">※必須</span></label>
                <input type="text" id="songTitle" placeholder="例：千本桜、残酷な天使のテーゼ、夜に駆ける" required>
                <div class="error-message" id="songTitleError">楽曲タイトルを入力してください</div>
              </div>
              <div class="form-group">
                <label for="artist">アーティスト <span class="required">※必須</span></label>
                <input type="text" id="artist" placeholder="例：初音ミク、高橋洋子、YOASOBI" required>
                <div class="error-message" id="artistError">アーティスト名を入力してください</div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="sourceType">使用音源 <span class="required">※必須</span></label>
                <select id="sourceType" required>
                  <option value="">選択してください</option>
                  <option value="original-karaoke">公式カラオケ音源</option>
                  <option value="nicokaraoke">ニコカラオケ</option>
                  <option value="youtube-karaoke">YouTube カラオケ</option>
                  <option value="instrumental">インストゥルメンタル</option>
                  <option value="midi">MIDI・自作音源</option>
                  <option value="other">その他</option>
                </select>
                <div class="error-message" id="sourceTypeError">使用音源を選択してください</div>
              </div>
              <div class="form-group">
                <label for="bpm">BPM <span class="optional">任意</span></label>
                <input type="number" id="bpm" placeholder="例：120、140、90" min="60" max="200">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="songKey">キー <span class="optional">任意</span></label>
                <input type="text" id="songKey" placeholder="例：C、G、Am、F#m、原キー">
              </div>
              <div class="form-group">
                <label for="vocalistCount">歌唱人数 <span class="required">※必須</span></label>
                <select id="vocalistCount" required>
                  <option value="">選択してください</option>
                  <option value="1" selected>1人（ソロ）</option>
                  <option value="2">2人（デュエット）</option>
                  <option value="3">3人</option>
                  <option value="4">4人</option>
                  <option value="5+">5人以上</option>
                </select>
                <div class="error-message" id="vocalistCountError">歌唱人数を選択してください</div>
              </div>
            </div>
          </div>
        </div>

        <!-- 制作・納期情報 -->
        <div class="form-card">
          <div class="form-section">
            <h3>⚙️ 制作・納期情報 <span class="section-indicator">必須</span></h3>
            
            <div class="form-group">
              <label>メインプラン <span class="required">※必須</span></label>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="mainService" value="full" data-price="5000" checked>
                  <span class="radio-label">⭐ フルコーラス MIX<br><small>¥5,000（ハモリ2トラック込み）</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="mainService" value="one" data-price="3000">
                  <span class="radio-label">ワンコーラス MIX<br><small>¥3,000（ハモリ2トラック込み）</small></span>
                </label>
                <label class="radio-item preparing-item">
                  <input type="radio" name="mainService" value="guide-single" disabled>
                  <span class="radio-label">🎤 ガイドボーカル作成（単体）<br><small>準備中</small></span>
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="deadline">希望納期 <span class="required">※必須</span></label>
              <select id="deadline" required>
                <option value="standard" selected>現在の標準納期（1か月前後）</option>
                <option value="consultation" style="color: var(--text-muted);" disabled>お急ぎ対応（現在停止中）</option>
                <option value="specific" style="color: var(--text-muted);" disabled>特定日指定（現在停止中）</option>
              </select>
              <div class="error-message" id="deadlineError">希望納期を選択してください</div>
              <div class="help-text" style="color: var(--warning); font-weight: 600;">
                ※依頼数増加により現在1か月前後のお時間をいただいております
              </div>
            </div>
          </div>
        </div>

        <!-- 録音音源情報 -->
        <div class="form-card">
          <div class="form-section">
            <h3>🎤 録音音源情報 <span class="section-indicator">重要</span></h3>
            
            <div style="background: #fff3cd; border: 2px solid var(--warning); border-radius: 12px; padding: 20px; margin-bottom: 25px;">
              <div style="color: var(--warning); font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-exclamation-triangle"></i>
                録音前の方は必ずご確認ください
              </div>
              <p style="margin: 0 0 15px 0; color: var(--warning); font-size: 0.9rem;">
                <strong>ご依頼の際は、<a href="recording-guide.html" style="color: var(--warning); text-decoration: underline;">📱 録音方法ガイド</a>を必ずご確認の上ご依頼ください。</strong><br>
                適切な録音方法により、MIXの仕上がりが大きく向上します。
              </p>
              
              <div class="form-group" style="margin-bottom: 0;">
                <label class="checkbox-item" style="background: white; border: 2px solid var(--warning); margin: 0;">
                  <input type="checkbox" id="recordingGuideConfirm" required>
                  <span style="font-weight: 600; color: var(--warning);">📱 録音方法ガイドを確認しました <span class="required">※必須</span></span>
                </label>
                <div class="error-message" id="recordingGuideConfirmError">録音方法ガイドの確認が必要です</div>
              </div>
            </div>
            
            <div class="form-group">
              <label>録音状況 <span class="required">※必須</span></label>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="recordingStatus" value="recorded" checked>
                  <span class="radio-label">録音済み<br><small>音源データをお送りできます</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="recordingStatus" value="not-recorded">
                  <span class="radio-label">録音前<br><small>これから録音予定です</small></span>
                </label>
              </div>
            </div>

            <div class="form-group" id="audioUrlSection">
              <label for="audioUrl">録音音源URL <span class="required">※必須（録音済みの場合）</span></label>
              <input type="url" id="audioUrl" placeholder="例：https://gigafile.nu/〇〇〇、https://drive.google.com/〇〇〇">
              <div class="error-message" id="audioUrlError">音源URLを入力してください</div>
              <div class="help-text">
                ギガファイル便、Google Drive、Dropbox等のURLをご入力ください<br>
                ※ファイル形式：WAV、AIFF、MP3等（WAV/AIFF推奨）<br>
                <strong><a href="recording-guide.html" style="color: var(--accent);">📱 録音方法がわからない方はこちらのガイドをご覧ください</a></strong>
              </div>
            </div>

            <div class="form-group">
              <label for="recordingNotes">録音音源についての追記事項 <span class="optional">任意</span></label>
              <textarea id="recordingNotes" placeholder="例：2分30秒あたりでノイズが入ってしまった、サビ部分だけ音量が小さい、複数テイク録音済み（Aメロ・サビ別々）、録音時にエアコンの音が少し入っている、iPhone12で録音・距離約30cm、ヘッドホン録音のためリークあり、特定の高音部分で音割れがある、間奏部分で息継ぎのタイミングがずれた"></textarea>
              <div class="help-text">録音時の問題点、環境、使用機材、気になる箇所など、MIX時に注意してほしい点があればご記入ください</div>
            </div>
          </div>
        </div>

        <!-- 参考音源 -->
        <div class="form-card">
          <div class="form-section">
            <h3>🎧 参考音源 <span class="section-indicator">推奨</span></h3>
            
            <div class="form-group">
              <label for="refUrlFull">参考音源URL（全体） <span class="optional">任意</span></label>
              <input type="url" id="refUrlFull" placeholder="例：https://www.youtube.com/watch?v=abc123（理想の仕上がりに近い楽曲）">
              <div class="help-text">全体的な仕上がりの参考にしたい楽曲のURL</div>
            </div>

            <div class="form-group">
              <label for="refUrlPart">参考音源URL（部分） <span class="optional">任意</span></label>
              <input type="url" id="refUrlPart" placeholder="例：https://youtu.be/def456?t=45（特定の処理の参考）">
              <div class="help-text">特定の処理（ハモリ、エフェクトなど）の参考にしたい部分</div>
            </div>
          </div>
        </div>

        <!-- MIX詳細設定 -->
        <div class="form-card">
          <div class="form-section">
            <h3>🎛️ MIX詳細設定 <span class="section-indicator">重要</span></h3>
            
            <div class="form-group">
              <label>ハモリ音源 <span class="required">※必須</span></label>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="harmonySource" value="none" checked>
                  <span class="radio-label">ハモリなし<br><small>メインボーカルのみでMIXを行います</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="harmonySource" value="available">
                  <span class="radio-label">音源あり<br><small>録音済みのハモリ音源があります</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="harmonySource" value="generate">
                  <span class="radio-label">音源無し（生成希望）<br><small>原曲に近い形でハモリを生成</small></span>
                </label>
              </div>
              <div class="form-group" id="harmonyGenerate" style="display: none; margin-top: 15px;">
                <label class="checkbox-item" style="background: #e3f2fd; border: 2px solid #1976d2;">
                  <input type="checkbox" id="harmonyAutoGenerate">
                  <span style="font-weight: 600; color: #1976d2;">原曲に近い形で+3+5-3-5（オクターブ上/下）を必要に応じて生成</span>
                </label>
                <div class="help-text" style="margin-top: 10px;">
                  楽曲の雰囲気に合わせて、適切なハモリ（3度上、5度上、3度下、5度下、オクターブ上下）を自動生成いたします
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label>ピッチ補正 <span class="required">※必須</span></label>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="pitchCorrection" value="complete">
                  <span class="radio-label">完全に揃える<br><small>機械的でも正確に</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="pitchCorrection" value="natural" checked>
                  <span class="radio-label">自然に揃える<br><small>自然さ重視</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="pitchCorrection" value="minimal">
                  <span class="radio-label">ほぼ原音のまま<br><small>最小限の補正</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="pitchCorrection" value="custom">
                  <span class="radio-label">その他<br><small>具体的に指定</small></span>
                </label>
              </div>
              <div class="form-group" id="pitchCustom" style="display: none; margin-top: 10px;">
                <input type="text" id="pitchCustomInput" placeholder="具体的なピッチ補正の指示を入力してください">
              </div>
            </div>

            <div class="form-group">
              <label>タイミング補正 <span class="required">※必須</span></label>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="timingCorrection" value="tight">
                  <span class="radio-label">しっかり揃える<br><small>リズム重視</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="timingCorrection" value="loose" checked>
                  <span class="radio-label">ゆるめに揃える<br><small>人間らしさ重視</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="timingCorrection" value="custom">
                  <span class="radio-label">その他<br><small>具体的に指定</small></span>
                </label>
              </div>
              <div class="form-group" id="timingCustom" style="display: none; margin-top: 10px;">
                <input type="text" id="timingCustomInput" placeholder="具体的なタイミング補正の指示を入力してください">
              </div>
            </div>

            <div class="form-group">
              <label>ブレス処理 <span class="required">※必須</span></label>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="breathProcessing" value="remove">
                  <span class="radio-label">削除<br><small>クリーンな仕上がり</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="breathProcessing" value="keep" checked>
                  <span class="radio-label">残す<br><small>自然な仕上がり</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="breathProcessing" value="custom">
                  <span class="radio-label">その他<br><small>部分的など</small></span>
                </label>
              </div>
              <div class="form-group" id="breathCustom" style="display: none; margin-top: 10px;">
                <input type="text" id="breathCustomInput" placeholder="具体的なブレス処理の指示を入力してください">
              </div>
            </div>

            <div class="form-group">
              <label>ロングトーンの処理 <span class="required">※必須</span></label>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="longTone" value="natural">
                  <span class="radio-label">自然な長さ<br><small>歌唱データの長さ重視</small></span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="longTone" value="reference" checked>
                  <span class="radio-label">リファレンスに合わせる<br><small>原曲の長さ重視</small></span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- ハモリ・エフェクト -->
        <div class="form-card">
          <div class="form-section">
            <h3>🎼 ハモリ・エフェクト <span class="section-indicator">任意</span></h3>
            
            <div class="form-group">
              <label for="harmonyDirection">ハモリの方向性 <span class="optional">任意</span></label>
              <textarea id="harmonyDirection" placeholder="例：「千本桜」サビのような厚めのハモリ、「夜に駆ける」の高音ハモリ風、3度上と5度上のダブルハモリ、控えめで自然なハモリ"></textarea>
              <div class="help-text">楽曲例や音楽理論での指定など、お好みの方法でご指定ください</div>
            </div>

            <div class="form-group">
              <label for="effects">エフェクト <span class="optional">任意</span></label>
              <textarea id="effects" placeholder="例：「ロキ」のようなディストーション、「怪物」のようなダークなリバーブ、爽やかなディレイ効果、ビンテージ感のあるエフェクト"></textarea>
              <div class="help-text">参考楽曲やエフェクトの種類でご指定ください</div>
            </div>

            <div class="form-group">
              <label for="specialEffects">特殊演出 <span class="optional">任意</span></label>
              <textarea id="specialEffects" placeholder="例：間奏でボーカルチョップ、サビ前でビルドアップ、アウトロでフェードアウト、特定箇所でボコーダー効果"></textarea>
              <div class="help-text">楽曲の特定部分での演出効果をご指定ください</div>
            </div>
          </div>
        </div>

        <!-- 追加オプション -->
        <div class="form-card">
          <div class="form-section">
            <h3>🎚️ 追加オプション <span class="section-indicator">任意</span></h3>
            
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="options" value="harmony" data-price="1000">
                <span>ハモリ追加（3トラック目から） (+¥1,000/トラック)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="options" value="encode" data-price="1000">
                <span>🎬 動画エンコード (+¥1,000)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="options" value="collab" data-price="2000">
                <span>👥 コラボ追加 
                  <select id="collabCount" style="margin-left: 8px; padding: 2px 6px; border-radius: 4px;">
                    <option value="1">1名 (+¥2,000)</option>
                    <option value="2">2名 (+¥4,000)</option>
                    <option value="3">3名 (+¥6,000)</option>
                    <option value="4">4名 (+¥8,000)</option>
                    <option value="5+">5名以上 (要相談)</option>
                  </select>
                </span>
              </label>
              <label class="checkbox-item preparing-item">
                <input type="checkbox" name="options" value="guide-with-mix" disabled>
                <span>🎤 ガイドボーカル作成（MIX同時依頼） (準備中)</span>
              </label>
              <label class="checkbox-item preparing-item">
                <input type="checkbox" name="options" value="guide-pdf" disabled>
                <span>📑 ガイド譜 PDF (準備中)</span>
              </label>
            </div>
            <div class="help-text">※基本プランにはハモリ2トラックまで含まれています</div>
          </div>
        </div>

        <!-- 割引・調整オプション -->
        <div class="form-card">
          <div class="form-section">
            <h3>💰 割引・調整オプション <span class="section-indicator">任意</span></h3>
            
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="discounts" value="no-pitch" data-price="-1000">
                <span>🔈 ピッチ補正なし (-¥1,000)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="discounts" value="repeater" data-price="-500">
                <span>🎁 リピーター割 (-¥500)</span>
              </label>
            </div>
            <div class="help-text">※ピッチ補正なしは"手直し不要"なテイクのみ対象</div>
          </div>
        </div>

        <!-- その他要望 -->
        <div class="form-card">
          <div class="form-section">
            <h3>📝 その他要望 <span class="section-indicator">任意</span></h3>
            
            <div class="form-group">
              <label for="additionalRequests">その他のご要望・特記事項</label>
              <textarea id="additionalRequests" placeholder="例：声の印象を可愛らしく仕上げたい、アニソン系の爽やかな仕上がり希望、録音時のノイズが気になる箇所が○分○秒あたりにあります、初めての依頼で不安なので丁寧にサポートしてください"></textarea>
            </div>

            <div class="form-group" style="margin-top: 25px;">
              <label class="checkbox-item" style="background: #f0e8f7; border: 2px solid var(--primary); margin: 0;">
                <input type="checkbox" id="optimalDirectionConsent" required>
                <span style="font-weight: 600; color: var(--primary-dark);">任意のご要望が未記入の場合、私の判断で最適な方向で進めます <span class="required">※必須</span></span>
              </label>
              <div class="error-message" id="optimalDirectionConsentError">同意が必要です</div>
              <div class="help-text" style="margin-top: 8px;">
                特別なご要望がない場合は、楽曲の特性と録音状況を考慮して、最も適切なMIX方向性で仕上げさせていただきます
              </div>
            </div>
          </div>
        </div>

        <!-- 料金プレビューを削除 -->

        <button type="button" class="generate-btn" id="generateBtn">
          📝 DM用文章を生成する
        </button>

        <div id="generateStatus" style="display: none; margin-top: 15px; padding: 15px; border-radius: 8px; text-align: center; font-weight: 600;">
          <!-- ステータス表示エリア -->
        </div>

        <div style="margin-top: 20px; padding: 20px; background: #e3f2fd; border-radius: 12px; text-align: center;">
          <h4 style="color: #1976d2; margin-bottom: 10px;">
            <i class="fas fa-info-circle"></i>
            生成後の流れ
          </h4>
          <p style="margin: 0; color: #1976d2; font-size: 0.9rem; line-height: 1.5;">
            文章生成後、コピーしてXのDMまたはメールでお送りください。<br>
            24時間以内にお見積もりと詳細をご返信いたします。
          </p>
        </div>
      </form>

      <!-- 生成結果 -->
      <div class="output-section" id="outputSection">
        <div class="output-card">
          <div class="output-header">
            <h3>✅ DM用文章が完成しました！</h3>
            <p>下記をコピーして、お好きな方法でご連絡ください</p>
          </div>
          
          <div class="output-content">
            <div class="copy-area" id="dmText">
              <!-- 生成された文章がここに表示 -->
            </div>
            <button class="copy-btn" id="copyBtn">📋 コピー</button>

            <div class="contact-buttons">
              <a href="#" class="contact-btn primary" id="twitterBtn" target="_blank">
                🐦 XのDMで送る
              </a>
              <a href="#" class="contact-btn" id="emailBtn">
                📧 メールで送る
              </a>
              <a href="https://forms.gle/kko1grBVSAXcypLF8" class="contact-btn" target="_blank">
                📝 フォームで送る
              </a>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: var(--bg-secondary); border-radius: 12px; text-align: center;">
              <h4 style="color: var(--primary-dark); margin-bottom: 10px;">
                <i class="fas fa-lightbulb"></i>
                その他のお問い合わせ方法
              </h4>
              <p style="color: var(--text-light); margin-bottom: 15px;">
                上記以外にも、ココナラ・SKIMAからもご依頼いただけます
              </p>
              <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <a href="https://coconala.com/services/2323053" target="_blank" style="color: var(--primary); text-decoration: none;">
                  <i class="fas fa-shopping-cart"></i> ココナラ
                </a>
                <a href="https://skima.jp/item/detail?item_id=239311" target="_blank" style="color: var(--primary); text-decoration: none;">
                  <i class="fas fa-palette"></i> SKIMA
                </a>
                <a href="index.html" style="color: var(--primary); text-decoration: none;">
                  <i class="fas fa-home"></i> メインページ
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM要素の取得
    const form = document.getElementById('requestForm');
    const generateBtn = document.getElementById('generateBtn');
    const outputSection = document.getElementById('outputSection');
    const dmTextEl = document.getElementById('dmText');
    const copyBtn = document.getElementById('copyBtn');
    const twitterBtn = document.getElementById('twitterBtn');
    const emailBtn = document.getElementById('emailBtn');

    console.log('要素取得確認:', {
      form: !!form,
      generateBtn: !!generateBtn,
      outputSection: !!outputSection,
      dmTextEl: !!dmTextEl
    });

    // 重要な要素が存在しない場合はエラーを表示
    if (!form || !generateBtn) {
      console.error('重要なDOM要素が見つかりません');
      alert('ページの読み込みに失敗しました。ページを再読み込みしてください。');
      return;
    }

    // カスタム入力フィールドと録音状況の表示制御
    function setupFormControls() {
      document.addEventListener('change', function(e) {
        if (e.target.name === 'harmonySource') {
          const harmonyGenerate = document.getElementById('harmonyGenerate');
          if (harmonyGenerate) {
            harmonyGenerate.style.display = e.target.value === 'generate' ? 'block' : 'none';
          }
        }
        if (e.target.name === 'pitchCorrection') {
          const pitchCustom = document.getElementById('pitchCustom');
          if (pitchCustom) {
            pitchCustom.style.display = e.target.value === 'custom' ? 'block' : 'none';
          }
        }
        if (e.target.name === 'timingCorrection') {
          const timingCustom = document.getElementById('timingCustom');
          if (timingCustom) {
            timingCustom.style.display = e.target.value === 'custom' ? 'block' : 'none';
          }
        }
        if (e.target.name === 'breathProcessing') {
          const breathCustom = document.getElementById('breathCustom');
          if (breathCustom) {
            breathCustom.style.display = e.target.value === 'custom' ? 'block' : 'none';
          }
        }
        
        // 録音状況による音源URL欄の表示制御
        if (e.target.name === 'recordingStatus') {
          const audioUrlSection = document.getElementById('audioUrlSection');
          const audioUrlInput = document.getElementById('audioUrl');
          
          if (audioUrlSection && audioUrlInput) {
            if (e.target.value === 'recorded') {
              audioUrlSection.style.display = 'block';
              audioUrlInput.required = true;
            } else {
              audioUrlSection.style.display = 'none';
              audioUrlInput.required = false;
              audioUrlInput.value = '';
            }
          }
        }
      });
    }

    // 文章生成関数
    function generateDMText() {
      console.log('DM文章生成開始');
      
      try {
        const formData = {
          clientName: document.getElementById('clientName')?.value?.trim() || '',
          clientContact: document.getElementById('clientContact')?.value?.trim() || '',
          contactMethod: document.getElementById('contactMethod')?.value || '',
          portfolioConsent: document.querySelector('input[name="portfolioConsent"]:checked')?.value || '',
          songTitle: document.getElementById('songTitle')?.value?.trim() || '',
          artist: document.getElementById('artist')?.value?.trim() || '',
          sourceType: document.getElementById('sourceType')?.value || '',
          bpm: document.getElementById('bpm')?.value || '',
          songKey: document.getElementById('songKey')?.value?.trim() || '',
          vocalistCount: document.getElementById('vocalistCount')?.value || '',
          mainService: document.querySelector('input[name="mainService"]:checked:not([disabled])')?.value || '',
          deadline: document.getElementById('deadline')?.value || '',
          recordingStatus: document.querySelector('input[name="recordingStatus"]:checked')?.value || '',
          audioUrl: document.getElementById('audioUrl')?.value?.trim() || '',
          recordingNotes: document.getElementById('recordingNotes')?.value?.trim() || '',
          refUrlFull: document.getElementById('refUrlFull')?.value?.trim() || '',
          refUrlPart: document.getElementById('refUrlPart')?.value?.trim() || '',
          pitchCorrection: document.querySelector('input[name="pitchCorrection"]:checked')?.value || '',
          pitchCustom: document.getElementById('pitchCustomInput')?.value?.trim() || '',
          harmonySource: document.querySelector('input[name="harmonySource"]:checked')?.value || '',
          harmonyAutoGenerate: document.getElementById('harmonyAutoGenerate')?.checked || false,
          timingCorrection: document.querySelector('input[name="timingCorrection"]:checked')?.value || '',
          timingCustom: document.getElementById('timingCustomInput')?.value?.trim() || '',
          breathProcessing: document.querySelector('input[name="breathProcessing"]:checked')?.value || '',
          breathCustom: document.getElementById('breathCustomInput')?.value?.trim() || '',
          longTone: document.querySelector('input[name="longTone"]:checked')?.value || '',
          harmonyDirection: document.getElementById('harmonyDirection')?.value?.trim() || '',
          effects: document.getElementById('effects')?.value?.trim() || '',
          specialEffects: document.getElementById('specialEffects')?.value?.trim() || '',
          additionalRequests: document.getElementById('additionalRequests')?.value?.trim() || '',
          optimalDirectionConsent: document.getElementById('optimalDirectionConsent')?.checked || false,
          recordingGuideConfirm: document.getElementById('recordingGuideConfirm')?.checked || false
        };

        console.log('フォームデータ取得完了:', formData);

        let dmText = 'こんにちは！Ryuzan Mix Salonの件でご連絡いたします☺️\n\n';

        // 依頼者情報
        dmText += '【依頼者情報】\n';
        dmText += `お名前：${formData.clientName || '未入力'}\n`;
        dmText += `連絡先：${formData.clientContact || '未入力'}\n`;
        
        const contactMethods = {
          'twitter': 'X（Twitter）DM',
          'email': 'メール',
          'discord': 'Discord',
          'line': 'LINE',
          'other': 'その他'
        };
        dmText += `希望連絡方法：${contactMethods[formData.contactMethod] || '未選択'}\n`;
        
        const portfolioConsents = {
          'allowed': '掲載可（ポートフォリオとして使用許可）',
          'denied': '掲載不可（ポートフォリオとして使用禁止）'
        };
        dmText += `ポートフォリオ掲載：${portfolioConsents[formData.portfolioConsent] || '未選択'}\n\n`;

        // 楽曲情報
        dmText += '【楽曲情報】\n';
        dmText += `楽曲タイトル：${formData.songTitle || '未入力'}\n`;
        dmText += `アーティスト：${formData.artist || '未入力'}\n`;
        
        const sourceTypes = {
          'original-karaoke': '公式カラオケ音源',
          'nicokaraoke': 'ニコカラオケ',
          'youtube-karaoke': 'YouTube カラオケ',
          'instrumental': 'インストゥルメンタル',
          'midi': 'MIDI・自作音源',
          'other': 'その他'
        };
        dmText += `使用音源：${sourceTypes[formData.sourceType] || '未選択'}\n`;

        dmText += `BPM：${formData.bpm || '未入力'}\n`;
        dmText += `キー：${formData.songKey || '未入力'}\n`;

        const vocalistCounts = {
          '1': '1人（ソロ）',
          '2': '2人（デュエット）',
          '3': '3人',
          '4': '4人',
          '5+': '5人以上'
        };
        dmText += `歌唱人数：${vocalistCounts[formData.vocalistCount] || '未選択'}\n\n`;

        // ご希望プラン
        dmText += '【ご希望プラン】\n';
        const mainServices = {
          'full': 'フルコーラス MIX（¥5,000）',
          'one': 'ワンコーラス MIX（¥3,000）'
        };
        dmText += `メインプラン：${mainServices[formData.mainService] || '未選択'}\n`;

        // 追加オプション
        const selectedOptions = document.querySelectorAll('input[name="options"]:checked:not([disabled])');
        if (selectedOptions.length > 0) {
          dmText += '追加オプション：';
          const optionTexts = [];
          selectedOptions.forEach(option => {
            if (option.value === 'collab') {
              const collabCount = document.getElementById('collabCount')?.value || '1';
              if (collabCount === '5+') {
                optionTexts.push('コラボ追加（5名以上・要相談）');
              } else {
                optionTexts.push(`コラボ追加（${collabCount}名）`);
              }
            } else {
              const optionNames = {
                'harmony': 'ハモリ追加',
                'encode': '動画エンコード',
                'guide-with-mix': 'ガイドボーカル作成',
                'guide-pdf': 'ガイド譜PDF'
              };
              optionTexts.push(optionNames[option.value] || option.value);
            }
          });
          dmText += optionTexts.join('、') + '\n';
        } else {
          dmText += '追加オプション：なし\n';
        }

        // 割引
        const selectedDiscounts = document.querySelectorAll('input[name="discounts"]:checked');
        if (selectedDiscounts.length > 0) {
          dmText += '割引：';
          const discountTexts = [];
          selectedDiscounts.forEach(discount => {
            const discountNames = {
              'no-pitch': 'ピッチ補正なし',
              'repeater': 'リピーター割'
            };
            discountTexts.push(discountNames[discount.value] || discount.value);
          });
          dmText += discountTexts.join('、') + '\n';
        } else {
          dmText += '割引：なし\n';
        }

        dmText += '\n';

        // 納期
        dmText += '【納期】\n';
        const deadlines = {
          'standard': '標準納期（1か月前後）',
          'consultation': 'お急ぎ対応希望（要相談）',
          'specific': '特定日指定（要相談）'
        };
        dmText += `希望納期：${deadlines[formData.deadline] || '未選択'}\n\n`;

        // 録音音源について
        dmText += '【録音音源について】\n';
        dmText += `録音ガイド確認：${formData.recordingGuideConfirm ? '確認済み' : '未確認'}\n`;
        
        const recordingStatuses = {
          'recorded': '録音済み',
          'not-recorded': 'これから録音予定'
        };
        dmText += `録音状況：${recordingStatuses[formData.recordingStatus] || '未選択'}\n`;
        
        if (formData.recordingStatus === 'recorded') {
          dmText += `音源URL：${formData.audioUrl || '未入力'}\n`;
        }
        dmText += `録音についての追記：${formData.recordingNotes || 'なし'}\n\n`;

        // 参考音源
        dmText += '【参考音源】\n';
        dmText += `全体参考URL：${formData.refUrlFull || 'なし'}\n`;
        dmText += `部分参考URL：${formData.refUrlPart || 'なし'}\n\n`;

        // MIX詳細設定
        dmText += '【MIX詳細設定】\n';
        
        const harmonySources = {
          'none': 'ハモリなし（メインボーカルのみ）',
          'available': '音源あり（録音済み）',
          'generate': `音源無し（生成希望${formData.harmonyAutoGenerate ? '・自動ハモリ生成' : ''}）`
        };
        dmText += `ハモリ音源：${harmonySources[formData.harmonySource] || '未選択'}\n`;
        
        const pitchCorrections = {
          'complete': '完全に揃える',
          'natural': '自然に揃える',
          'minimal': 'ほぼ原音のまま',
          'custom': `その他（${formData.pitchCustom || '詳細未入力'}）`
        };
        dmText += `ピッチ補正：${pitchCorrections[formData.pitchCorrection] || '未選択'}\n`;

        const timingCorrections = {
          'tight': 'しっかり揃える',
          'loose': 'ゆるめに揃える',
          'custom': `その他（${formData.timingCustom || '詳細未入力'}）`
        };
        dmText += `タイミング補正：${timingCorrections[formData.timingCorrection] || '未選択'}\n`;

        const breathProcessings = {
          'remove': '削除',
          'keep': '残す',
          'custom': `その他（${formData.breathCustom || '詳細未入力'}）`
        };
        dmText += `ブレス処理：${breathProcessings[formData.breathProcessing] || '未選択'}\n`;

        const longTones = {
          'natural': '自然な長さ',
          'reference': 'リファレンスに合わせる'
        };
        dmText += `ロングトーン処理：${longTones[formData.longTone] || '未選択'}\n\n`;

        // ハモリ・エフェクト
        dmText += '【ハモリ・エフェクト】\n';
        dmText += `ハモリの方向性：${formData.harmonyDirection || 'なし'}\n`;
        dmText += `エフェクト：${formData.effects || 'なし'}\n`;
        dmText += `特殊演出：${formData.specialEffects || 'なし'}\n\n`;

        // その他要望
        dmText += '【その他ご要望】\n';
        dmText += `${formData.additionalRequests || 'なし'}\n`;
        dmText += `最適な方向での進行同意：${formData.optimalDirectionConsent ? '同意済み' : '未同意'}\n\n`;

        // お支払い方法
        dmText += '【お支払い方法】\n';
        dmText += 'PayPay（推奨）、Amazonギフトカード\n';
        dmText += '※その他の支払い方法は準備中です\n\n';

        dmText += '何かご不明な点がございましたら、お気軽にお声がけください。\n';
        dmText += 'どうぞよろしくお願いいたします☺️';

        console.log('DM文章生成完了');
        return dmText;

      } catch (error) {
        console.error('DM文章生成エラー:', error);
        throw error;
      }
    }

    // ボタンイベントの設定
    function setupGenerateButton() {
      console.log('ボタンイベント設定開始');
      
      if (!generateBtn) {
        console.error('generateBtnが見つかりません');
        return;
      }

      generateBtn.addEventListener('click', function() {
        console.log('🔥 DM生成ボタンがクリックされました！');
        
        try {
          // ボタンの状態を変更（処理中表示）
          const originalText = generateBtn.textContent;
          generateBtn.disabled = true;
          generateBtn.textContent = '⏳ 処理中...';
          generateBtn.style.background = '#999999';
          
          // ステータス表示
          const statusEl = document.getElementById('generateStatus');
          if (statusEl) {
            statusEl.style.display = 'block';
            statusEl.style.background = '#e3f2fd';
            statusEl.style.color = '#1976d2';
            statusEl.textContent = '📝 DM文章を生成しています...';
          }

          setTimeout(() => {
            try {
              // 文章生成を実行
              const dmText = generateDMText();
              
              if (dmTextEl) {
                dmTextEl.textContent = dmText;
              }
              
              if (outputSection) {
                outputSection.classList.add('show');
                outputSection.scrollIntoView({ behavior: 'smooth' });
              }

              // URLを生成（長さ制限対応）
              const encodedText = encodeURIComponent(dmText);
              
              // Twitter DMのURL長さ制限チェック（約2000文字程度）
              const twitterUrl = `https://x.com/messages/compose?recipient_id=ryuzanmix&text=${encodedText}`;
              const emailUrl = `mailto:ryuzan.mix@gmail.com?subject=MIX依頼のご相談&body=${encodedText}`;
              
              if (twitterBtn) {
                if (twitterUrl.length > 2000) {
                  twitterBtn.href = `https://x.com/messages/compose?recipient_id=ryuzanmix`;
                  twitterBtn.title = '依頼文が長いため、コピーしてDMに貼り付けてください';
                } else {
                  twitterBtn.href = twitterUrl;
                  twitterBtn.title = '';
                }
              }
              
              if (emailBtn) {
                if (emailUrl.length > 2000) {
                  emailBtn.href = `mailto:ryuzan.mix@gmail.com?subject=MIX依頼のご相談`;
                  emailBtn.title = '依頼文が長いため、コピーしてメール本文に貼り付けてください';
                } else {
                  emailBtn.href = emailUrl;
                  emailBtn.title = '';
                }
              }
              
              // 成功ステータス表示
              if (statusEl) {
                statusEl.style.background = '#e8f5e8';
                statusEl.style.color = '#4caf50';
                statusEl.textContent = '🎉 DM文章が生成されました！下にスクロールしてご確認ください';
              }
              
              // ボタン状態を元に戻す
              generateBtn.disabled = false;
              generateBtn.textContent = originalText;
              generateBtn.style.background = '';
              
              // 3秒後にステータスを非表示
              if (statusEl) {
                setTimeout(() => {
                  statusEl.style.display = 'none';
                }, 3000);
              }
              
            } catch (error) {
              console.error('文章生成エラー:', error);
              
              // ボタン状態を元に戻す
              generateBtn.disabled = false;
              generateBtn.textContent = originalText;
              generateBtn.style.background = '';
              
              // ステータス表示をエラーに変更
              if (statusEl) {
                statusEl.style.background = '#ffebee';
                statusEl.style.color = '#f44336';
                statusEl.textContent = '❌ 文章生成でエラーが発生しました';
              }
              
              alert('❌ 文章生成時にエラーが発生しました。\n\nページを再読み込みして再度お試しください。');
              
              // 5秒後にステータスを非表示
              if (statusEl) {
                setTimeout(() => {
                  statusEl.style.display = 'none';
                }, 5000);
              }
            }
          }, 100);
          
        } catch (error) {
          console.error('ボタンクリックエラー:', error);
          alert('ボタンの処理でエラーが発生しました。');
        }
      });

      console.log('ボタンイベント設定完了');
    }

    // コピーボタンの設定
    function setupCopyButton() {
      if (!copyBtn) return;

      copyBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(dmTextEl.textContent);
          copyBtn.textContent = '✅ コピー完了！';
          copyBtn.classList.add('copied');
          setTimeout(() => {
            copyBtn.textContent = '📋 コピー';
            copyBtn.classList.remove('copied');
          }, 2000);
        } catch (err) {
          // フォールバック
          const textArea = document.createElement('textarea');
          textArea.value = dmTextEl.textContent;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          
          copyBtn.textContent = '✅ コピー完了！';
          copyBtn.classList.add('copied');
          setTimeout(() => {
            copyBtn.textContent = '📋 コピー';
            copyBtn.classList.remove('copied');
          }, 2000);
        }
      });
    }

    // 初期化関数
    function initializeForm() {
      console.log('フォーム初期化開始');
      
      try {
        // ボタンを常に有効に設定
        if (generateBtn) {
          generateBtn.disabled = false;
          console.log('ボタンを有効化しました');
        }
        
        // 初期状態での録音状況表示制御
        const initialRecordingStatus = document.querySelector('input[name="recordingStatus"]:checked');
        const audioUrlSection = document.getElementById('audioUrlSection');
        const audioUrlInput = document.getElementById('audioUrl');
        
        if (initialRecordingStatus && audioUrlSection && audioUrlInput) {
          if (initialRecordingStatus.value === 'not-recorded') {
            audioUrlSection.style.display = 'none';
            audioUrlInput.required = false;
          }
        }

        // 初期状態でのハモリ音源表示制御
        const initialHarmonySource = document.querySelector('input[name="harmonySource"]:checked');
        const harmonyGenerateSection = document.getElementById('harmonyGenerate');
        
        if (initialHarmonySource && harmonyGenerateSection) {
          if (initialHarmonySource.value !== 'generate') {
            harmonyGenerateSection.style.display = 'none';
          }
        }

        console.log('フォーム初期化完了');
      } catch (error) {
        console.error('初期化エラー:', error);
      }
    }

    // フォーム送信を防ぐ
    if (form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('フォーム送信が防がれました');
        if (generateBtn && !generateBtn.disabled) {
          generateBtn.click();
        }
      });
    }

    // Enterキーでの送信防止
    if (form) {
      form.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && e.target.type !== 'textarea') {
          e.preventDefault();
          if (generateBtn && !generateBtn.disabled) {
            generateBtn.click();
          }
        }
      });
    }

    // すべての初期化を実行
    console.log('初期化処理開始');
    setupFormControls();
    setupGenerateButton();
    setupCopyButton();
    initializeForm();
    
    // DOMContentLoaded時の追加初期化
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOMContentLoaded - 追加初期化');
        initializeForm();
        if (generateBtn) {
          generateBtn.disabled = false;
        }
      });
    } else {
      console.log('DOM already loaded - 即座に初期化');
      initializeForm();
      if (generateBtn) {
        generateBtn.disabled = false;
      }
    }

    console.log('🚀 全ての初期化処理が完了しました');
  </script>

  <!-- 構造化データ -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "詳細依頼フォーム - Ryuzan Mix Salon",
    "description": "詳細な設定で依頼文章を自動生成！プロ仕様の歌ってみたMIX依頼フォーム。",
    "url": "https://ryuzanmix.github.io/request-form.html",
    "isPartOf": {
      "@type": "WebSite",
      "name": "Ryuzan Mix Salon",
      "url": "https://ryuzanmix.github.io/"
    },
    "about": {
      "@type": "Service",
      "name": "歌ってみたMIXサービス",
      "provider": {
        "@type": "Organization",
        "name": "Ryuzan Mix Salon"
      }
    }
  }
  </script>
</body>
</html>